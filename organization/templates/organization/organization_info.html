{% extends 'base.html' %}
{% block title %}WorkSafeCenter - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏{% endblock %}

{% block content %}
<section style="background: transparent; box-shadow: none; padding: 0;">
    <div class="section-header" style="border-bottom: none; margin-bottom: 20px;">
        <h2>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</h2>
    </div>

    <div class="profile-card" style="margin-bottom: 30px; border-left: 5px solid var(--accent-color);">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <h3 class="profile-title" style="border: none; margin-bottom: 10px;">
                    {{ safety_info.school_name|default:"–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ" }}
                </h3>
                <p style="color: #666; margin-top: 0; font-size: 0.9em;">
                    –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞
                </p>
            </div>
            <a href="{% url 'organization:safety_info_edit' %}" class="button">
                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
            </a>
        </div>

        {% if safety_info %}
        <div class="info-grid" style="margin-top: 20px;">
            <div class="info-item">
                <label>–î–∏—Ä–µ–∫—Ç–æ—Ä (–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å)</label>
                <span style="font-size: 1.1em;">{{ safety_info.director_name }}</span>
            </div>
            <div class="info-item">
                <label>–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞</label>
                <span style="font-size: 1.1em;">{{ safety_info.ot_specialist_name }}</span>
            </div>
            <div class="info-item">
                <label>–î–∞—Ç–∞ –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤</label>
                <span>{{ safety_info.risk_assessment_date|date:"d.m.Y"|default:"–ù–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∞—Å—å" }}</span>
            </div>
        </div>
        {% else %}
        <div style="background-color: #fff3cd; color: #856404; padding: 15px; border-radius: 4px; margin-top: 15px;">
            ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –µ—â–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã", —á—Ç–æ–±—ã –≤–Ω–µ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.
        </div>
        {% endif %}
    </div>
</section>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">

    <section>
        <div class="section-header">
            <h3>üìÇ –û—Ç–¥–µ–ª—ã</h3>
            <a href="{% url 'organization:department_create' %}" class="button" style="padding: 5px 10px; font-size: 0.9em;">+ –î–æ–±–∞–≤–∏—Ç—å</a>
        </div>
        {% if departments %}
        <table style="font-size: 0.9em;">
            <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ / –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</th>
                    <th style="width: 80px;">–î–µ–π—Å—Ç–≤.</th>
                </tr>
            </thead>
            <tbody>
                {% for dept in departments %}
                <tr>
                    <td>
                        <strong>{{ dept.name }}</strong>
                        {% if dept.head %}
                        <div style="font-size: 0.85em; color: #666; margin-top: 3px;">
                            üë§ {{ dept.head.last_name }} {{ dept.head.first_name|slice:":1" }}.
                        </div>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'organization:department_update' dept.pk %}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                        <a href="{% url 'organization:department_delete' dept.pk %}" title="–£–¥–∞–ª–∏—Ç—å" style="color: var(--danger-color);">üóëÔ∏è</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: #777; font-style: italic;">–û—Ç–¥–µ–ª—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã.</p>
        {% endif %}
    </section>

    <section>
        <div class="section-header">
            <h3>üëî –î–æ–ª–∂–Ω–æ—Å—Ç–∏</h3>
            <a href="{% url 'organization:position_create' %}" class="button" style="padding: 5px 10px; font-size: 0.9em;">+ –î–æ–±–∞–≤–∏—Ç—å</a>
        </div>
        {% if positions %}
        <table style="font-size: 0.9em;">
            <thead>
                <tr>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ / –ü—Ä–∏–≤—è–∑–∫–∞</th>
                    <th style="width: 80px;">–î–µ–π—Å—Ç–≤.</th>
                </tr>
            </thead>
            <tbody>
                {% for pos in positions %}
                <tr>
                    <td>
                        <strong>{{ pos.name }}</strong>
                        {% if pos.department %}
                        <div style="font-size: 0.85em; color: #666; margin-top: 3px;">
                            üè¢ {{ pos.department.name }}
                        </div>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'organization:position_update' pos.pk %}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                        <a href="{% url 'organization:position_delete' pos.pk %}" title="–£–¥–∞–ª–∏—Ç—å" style="color: var(--danger-color);">üóëÔ∏è</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: #777; font-style: italic;">–î–æ–ª–∂–Ω–æ—Å—Ç–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã.</p>
        {% endif %}
    </section>
</div>

<section>
    <div class="section-header">
        <h3>üìç –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–ª–æ—â–∞–¥–∫–∏ / –§–∏–ª–∏–∞–ª—ã</h3>
        <a href="{% url 'organization:site_create' %}" class="button">+ –î–æ–±–∞–≤–∏—Ç—å –ø–ª–æ—â–∞–¥–∫—É</a>
    </div>

    {% if sites %}
    <table>
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–ê–¥—Ä–µ—Å</th>
                <th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –û–¢</th>
                <th style="width: 100px;">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for site in sites %}
            <tr>
                <td><strong>{{ site.name }}</strong></td>
                <td>{{ site.address }}</td>
                <td>{{ site.ot_responsible_name }}</td>
                <td>
                    <a href="{% url 'organization:site_update' site.pk %}" style="margin-right: 10px;">‚úèÔ∏è</a>
                    <a href="{% url 'organization:site_delete' site.pk %}" style="color: var(--danger-color);">üóëÔ∏è</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="text-align: center; padding: 20px; color: #777;">
        <p>–ü–ª–æ—â–∞–¥–∫–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã. –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª–∏–∞–ª—ã –∏–ª–∏ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –¥–ª—è –≤–µ–¥–µ–Ω–∏—è —É—á–µ—Ç–∞ –ø–æ –º–µ—Å—Ç–∞–º.</p>
    </div>
    {% endif %}
</section>

{% endblock %}