{% extends 'base.html' %}
{% block title %}WorkSafeCenter - –ò–Ω—Ñ–æ{% endblock %}

{% block content %}
<section style="background: transparent; box-shadow: none; padding: 0;">
    <div class="section-header" style="border-bottom: none; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
        <h2 style="margin: 0;">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</h2>
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'organization:department_create' %}" class="button success">+ –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª</a>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1.2fr 1fr; gap: 25px; align-items: start;">

        <div style="display: flex; direction: ltr; flex-direction: column; gap: 25px;">

            <div class="profile-card" style="margin: 0; border-left: 5px solid var(--accent-color);">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                    <h3 class="profile-title" style="border: none; margin: 0;">
                        {{ safety_info.name_full|default:"–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ" }}
                    </h3>
                    <a href="{% url 'organization:safety_info_edit' %}" class="button-small" style="text-decoration: none;">‚úèÔ∏è</a>
                </div>

                {% if safety_info %}
                <div class="info-grid">
                    <div class="info-item">
                        <label>–î–∏—Ä–µ–∫—Ç–æ—Ä</label>
                        <p>{{ safety_info.head_name|default:"-" }}</p>
                    </div>
                    <div class="info-item">
                        <label>–ò–ù–ù / –ö–ü–ü</label>
                        <p>{{ safety_info.inn|default:"-" }} / {{ safety_info.kpp|default:"-" }}</p>
                    </div>
                    <div class="info-item">
                        <label>–û–ì–†–ù</label>
                        <p>{{ safety_info.ogrn|default:"-" }}</p>
                    </div>
                    <div class="info-item">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω / E-mail</label>
                        <p>{{ safety_info.contact_phone|default:"-" }} / {{ safety_info.contact_email|default:"-" }}</p>
                    </div>
                    <div class="info-item form-full-width">
                        <label>–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</label>
                        <p>{{ safety_info.address_legal|default:"-" }}</p>
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="profile-card" style="margin: 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 class="profile-title" style="border: none; margin: 0; font-size: 1.1em;">üìç –§–∏–ª–∏–∞–ª—ã –∏ –ø–ª–æ—â–∞–¥–∫–∏</h3>
                    <a href="{% url 'organization:site_create' %}" style="text-decoration: none; font-size: 0.85em; color: var(--accent-color);">+ –î–æ–±–∞–≤–∏—Ç—å</a>
                </div>

                <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                    {% for site in sites %}
                        <div style="border: 1px solid #f0f0f0; padding: 10px; border-radius: 6px; font-size: 0.9em; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: var(--primary-color);">{{ site.name }}</strong><br>
                                <small style="color: #666;">{{ site.address|truncatechars:50 }}</small>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <a href="{% url 'organization:site_edit' site.pk %}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                                <a href="{% url 'organization:site_delete' site.pk %}" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
                            </div>
                        </div>
                    {% empty %}
                        <p style="color: #999; font-style: italic; font-size: 0.9em; text-align: center;">–ü–ª–æ—â–∞–¥–∫–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="profile-card" style="margin: 0;">
            <h3 class="profile-title" style="border-bottom: 2px solid #f0f0f0; margin-bottom: 15px; padding-bottom: 10px;">
                üìÇ –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
            </h3>

            <div class="departments-accordion">
                {% for department in departments %}
                    <details style="margin-bottom: 8px; border: 1px solid #eee; border-radius: 6px; background: #fff;">
                        <summary style="padding: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 500; list-style: none;">
                            <span style="display: flex; align-items: center; gap: 8px;">
                                <span style="color: var(--accent-color);">‚ñº</span>
                                {{ department.name }}
                                <span style="font-weight: normal; color: #888; font-size: 0.85em;">({{ department.position_set.count }})</span>
                            </span>
                            <a href="{% url 'organization:department_update' department.pk %}" style="text-decoration: none; font-size: 0.9em;">‚úèÔ∏è</a>
                        </summary>

                        <div style="padding: 0 12px 12px 35px; border-top: 1px solid #fafafa;">
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                {% for position in department.position_set.all %}
                                    <li style="display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid #f9f9f9; font-size: 0.9em;">
                                        <span>{{ position.name }}</span>
                                        <div style="display: flex; gap: 8px; opacity: 0.5;">
                                            <a href="{% url 'organization:position_update' position.pk %}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                                            <a href="{% url 'organization:position_delete' position.pk %}" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
                                        </div>
                                    </li>
                                {% endfor %}
                                <li style="margin-top: 10px;">
                                    <a href="{% url 'organization:position_create' %}?department={{ department.pk }}"
                                       style="color: var(--accent-color); text-decoration: none; font-size: 0.85em; font-weight: 600;">
                                        + –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–∂–Ω–æ—Å—Ç—å
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </details>
                {% empty %}
                    <p style="text-align: center; color: #999; padding: 20px;">–û—Ç–¥–µ–ª—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã</p>
                {% endfor %}
            </div>
        </div>

    </div>
</section>

<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ */
    details summary::-webkit-details-marker { display: none; }
    details[open] summary span span { transform: rotate(180deg); display: inline-block; }
    summary:hover { background-color: #fcfcfc; }

    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –¥–ª—è info-grid */
    .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .info-item label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; color: #888; margin-bottom: 3px; display: block; }
    .info-item p { margin: 0; font-weight: 500; color: #333; font-size: 0.95rem; }
    .button.success { background-color: #28a745; color: white; border: none; }
</style>
{% endblock %}