{% extends 'base.html' %}
{% block title %}WorkSafeCenter - Структура организации{% endblock %}

{% block content %}
<section style="background: transparent; box-shadow: none; padding: 0;">
    <div class="section-header" style="border-bottom: none; margin-bottom: 20px;">
        <h2>Структура и реквизиты организации</h2>
    </div>

    <div class="profile-card" style="margin-bottom: 30px; border-left: 5px solid var(--accent-color);">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <h3 class="profile-title" style="border: none; margin-bottom: 10px;">
                    {{ safety_info.name_full|default:"Название организации не указано" }}
                </h3>
                <p style="color: #666; margin-top: 0; font-size: 0.9em;">
                    Общие сведения по охране труда
                </p>
            </div>
            <a href="{% url 'organization:safety_info_edit' %}" class="button">
                ✏️ Редактировать реквизиты
            </a>
        </div>

        {% if safety_info %}
        <div class="info-grid" style="margin-top: 20px;">

            <div class="info-item">
                <label>Директор (Руководитель)</label>
                {% with director=safety_info.get_effective_director %}
                    {% if director %}
                        <p>
                            <strong>{{ director.get_full_name }}</strong>
                            {% if safety_info.director_position and not director.is_acting_director %}
                                ({{ safety_info.director_position }})
                            {% elif director.is_acting_director %}
                                (И.о. директора)
                            {% else %}
                                (Директор)
                            {% endif %}
                        </p>
                    {% else %}
                        <p style="color: var(--danger-color);">Руководитель не назначен</p>
                    {% endif %}
                {% endwith %}
            </div>

            <div class="info-item">
                <label>Специалист по охране труда</label>
                {% with specialist=safety_info.get_effective_safety_specialist %}
                    {% if specialist %}
                        <p>
                            <strong>{{ specialist.get_full_name }}</strong>
                        </p>
                    {% else %}
                        <p style="color: var(--warning-color);">Не назначен</p>
                    {% endif %}
                {% endwith %}
            </div>

            <div class="info-item">
                <label>ИНН</label>
                <p>{{ safety_info.inn|default:"-" }}</p>
            </div>
            <div class="info-item">
                <label>ОГРН</label>
                <p>{{ safety_info.ogrn|default:"-" }}</p>
            </div>
            <div class="info-item form-full-width">
                <label>Юридический адрес</label>
                <p>{{ safety_info.address_legal|default:"-" }}</p>
            </div>

            <div class="info-item form-full-width">
                <label>Комиссия по охране труда</label>
                {% with members=safety_info.get_committee_members_including_chair %}
                    {% if members %}
                        <ul>
                        {% for member in members %}
                            <li>
                                <strong>{{ member.get_full_name }}</strong>
                                ({{ member.position }})
                                {% if member.is_safety_committee_chair %}
                                    <span style="color: var(--accent-color); font-weight: bold;">— Председатель</span>
                                {% endif %}
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <p style="color: #777; font-style: italic;">Состав комиссии не назначен.</p>
                    {% endif %}
                {% endwith %}
            </div>

        </div>
        {% else %}
        <div style="text-align: center; padding: 20px; color: var(--danger-color);">
            <p><strong>Данные организации не заполнены.</strong> Пожалуйста, нажмите "Редактировать реквизиты" для настройки.</p>
        </div>
        {% endif %}

    </div>

    {% endblock %}