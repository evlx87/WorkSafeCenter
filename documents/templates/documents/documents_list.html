{% extends 'base.html' %}
{% block title %}WorkSafeCenter - –†–µ–µ—Å—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤{% endblock %}

{% block content %}
<section>
    <div class="section-header">
        <h2>üìÇ –†–µ–µ—Å—Ç—Ä –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –∞–∫—Ç–æ–≤</h2>
        <a href="{% url 'documents:document_create' %}" class="button"> + –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</a>
    </div>

    <form method="get" action="{% url 'documents:documents_list' %}" class="filter-toolbar">
        <input
            type="text"
            name="search_query"
            placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
            value="{{ search_query }}"
        >
        <select name="category">
            <option value="">üóÇÔ∏è –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            {% for cat in categories %}
            <option value="{{ cat.pk }}" {% if cat.pk|stringformat:"s" == selected_category %}selected{% endif %}>
                {{ cat.name }}
            </option>
            {% endfor %}
        </select>

        <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <a href="{% url 'documents:documents_list' %}" style="color: #666; margin-left: 10px; font-size: 0.9em;">–°–±—Ä–æ—Å–∏—Ç—å</a>
    </form>

    {% if documents %}
    <table>
        <thead>
        <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–§–∞–π–ª</th>
            <th style="width: 120px;">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        {% for doc in documents %}
        <tr {% if doc.is_overdue %}style="background-color: #fef5f5;"{% endif %}>
            <td>
                <a href="{% url 'documents:document_detail' doc.pk %}" style="font-weight: bold; color: var(--primary-color);">
                    {{ doc.title }}
                </a>
                <div style="font-size: 0.85em; color: #666; margin-top: 3px;">
                    –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ doc.category.name }}
                </div>
            </td>
            <td>
                {% if doc.end_date %}
                    {{ doc.end_date|date:"d.m.Y" }}
                {% else %}
                    –ë–µ—Å—Å—Ä–æ—á–Ω–æ
                {% endif %}
            </td>
            <td>
                {% if doc.is_overdue %}
                    <span class="badge badge-danger">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω</span>
                {% elif doc.days_to_expire < 90 and doc.end_date %}
                    <span class="badge badge-warning">–ò—Å—Ç–µ–∫–∞–µ—Ç —Å–∫–æ—Ä–æ</span>
                {% else %}
                    <span class="badge badge-success">–ê–∫—Ç—É–∞–ª–µ–Ω</span>
                {% endif %}
            </td>
            <td>
                {% if doc.document_file %}
                    <a href="{{ doc.document_file.url }}" target="_blank" style="color: var(--accent-color);">
                        ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å
                    </a>
                {% else %}
                    <span style="color: #ccc;">–ù–µ—Ç —Ñ–∞–π–ª–∞</span>
                {% endif %}
            </td>
            <td>
                <a href="{% url 'documents:document_update' doc.pk %}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                <a href="{% url 'documents:document_delete' doc.pk %}" title="–£–¥–∞–ª–∏—Ç—å" style="color: var(--danger-color); margin-left: 10px;">üóëÔ∏è</a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 30px; color: #777;">–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
    {% endif %}
</section>
{% endblock %}