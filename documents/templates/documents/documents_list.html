{% extends 'base.html' %}
{% block title %}WorkSafeCenter - –†–µ–µ—Å—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤{% endblock %}

{% block content %}
<section>
    <div class="section-header">
        <h2>üìÇ –†–µ–µ—Å—Ç—Ä –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –∞–∫—Ç–æ–≤</h2>
        <a href="{% url 'documents:document_create' %}" class="button"> + –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</a>
    </div>

    <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="?group=federal" class="button" style="background-color: #2980b9; text-decoration: none;">‚öñÔ∏è –ù–ü–ê (–†–§)</a>
        <a href="?group=org" class="button" style="background-color: #27ae60; text-decoration: none;">üè¢ –õ–æ–∫–∞–ª—å–Ω—ã–µ –∞–∫—Ç—ã</a>
        <a href="{% url 'documents:documents_list' %}" class="button" style="background-color: #95a5a6; text-decoration: none;">–í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</a>
    </div>

    <form method="get" action="{% url 'documents:documents_list' %}" class="filter-toolbar" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <input
            type="text"
            name="search_query"
            placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
            value="{{ search_query|default:'' }}"
            style="min-width: 300px;"
        >

        <select name="doc_type">
            <option value="">üìã –í—Å–µ —Ç–∏–ø—ã</option>
            {% for code, name in doc_types %}
            <option value="{{ code }}" {% if code == selected_doc_type %}selected{% endif %}>
                {{ name }}
            </option>
            {% endfor %}
        </select>

        <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <a href="{% url 'documents:documents_list' %}" style="color: #666; margin-left: 10px; font-size: 0.9em;">–°–±—Ä–æ—Å–∏—Ç—å</a>
    </form>

    {% if documents %}
    <div class="profile-card" style="padding: 0; overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
            <tr style="background-color: #f2f2f2; text-align: left;">
                <th style="padding: 12px;">–ù–∞–∑–≤–∞–Ω–∏–µ –∏ —Ç–∏–ø</th>
                <th style="padding: 12px;">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</th>
                <th style="padding: 12px;">–°—Ç–∞—Ç—É—Å</th>
                <th style="padding: 12px;">–î–æ–∫—É–º–µ–Ω—Ç</th>
                <th style="padding: 12px; width: 100px; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            </thead>
            <tbody>
            {% for doc in documents %}
            <tr style="border-bottom: 1px solid #eee; {% if doc.is_overdue %}background-color: #fff5f5;{% endif %}">
                <td style="padding: 12px;">
                    <div style="font-weight: bold; color: var(--primary-color);">{{ doc.title }}</div>
                    <div style="font-size: 0.85em; color: #666; margin-top: 3px;">
                        {{ doc.get_document_type_display }}
                        {% if doc.employee %}
                         | üë§ {{ doc.employee.last_name }} {{ doc.employee.first_name|slice:":1" }}.
                        {% endif %}
                    </div>
                </td>
                <td style="padding: 12px;">
                    {% if doc.end_date %}
                        {{ doc.end_date|date:"d.m.Y" }}
                    {% else %}
                        <span style="color: #95a5a6;">–ë–µ—Å—Å—Ä–æ—á–Ω–æ</span>
                    {% endif %}
                </td>
                <td style="padding: 12px;">
                    {% if doc.end_date %}
                        {% if doc.is_overdue %}
                            <span style="background-color: var(--danger-color); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em;">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω</span>
                        {% else %}
                            <span style="background-color: #27ae60; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em;">–ê–∫—Ç—É–∞–ª–µ–Ω</span>
                        {% endif %}
                    {% else %}
                        <span style="background-color: #27ae60; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em;">–î–µ–π—Å—Ç–≤—É–µ—Ç</span>
                    {% endif %}
                </td>
                <td style="padding: 12px;">
                    {% if doc.file %}
                        <a href="{{ doc.file.url }}" target="_blank" style="text-decoration: none; color: #2980b9;">‚¨áÔ∏è –§–∞–π–ª</a>
                    {% elif doc.external_link %}
                        <a href="{{ doc.external_link }}" target="_blank" style="text-decoration: none; color: #2980b9;">üîó –°—Å—ã–ª–∫–∞</a>
                    {% else %}
                        <span style="color: #ccc;">–ù–µ—Ç —Ñ–∞–π–ª–∞</span>
                    {% endif %}
                </td>
                <td style="padding: 12px; text-align: center;">
                    <a href="{% url 'documents:documents_list' %}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                    <a href="{% url 'documents:document_delete' doc.pk %}" title="–£–¥–∞–ª–∏—Ç—å" style="color: var(--danger-color); margin-left: 10px;">üóëÔ∏è</a>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="text-align: center; padding: 50px; background: white; border-radius: 8px;">
        <p style="color: #777;">–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
    </div>
    {% endif %}
</section>
{% endblock %}