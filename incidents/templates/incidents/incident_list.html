{% extends 'base.html' %}
{% block title %}WorkSafeCenter - –ñ—É—Ä–Ω–∞–ª –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤{% endblock %}

{% block content %}
<section>
    <div class="section-header">
        <h2>üö® –ñ—É—Ä–Ω–∞–ª –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏–π –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤</h2>
        <a href="{% url 'incidents:incident_create' %}" class="button" style="background-color: var(--danger-color);"> + –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç</a>
    </div>

    <form method="get" action="{% url 'incidents:incident_list' %}" class="filter-toolbar">
        <input
            type="text"
            name="search_query"
            placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É..."
            value="{{ search_query }}"
        >
        <select name="severity">
            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç—è–∂–µ—Å—Ç–∏</option>
            {% for value, label in severity_choices %}
            <option value="{{ value }}" {% if value|stringformat:"s" == selected_severity %}selected{% endif %}>
                {{ label }}
            </option>
            {% endfor %}
        </select>

        <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <a href="{% url 'incidents:incident_list' %}" style="color: #666; margin-left: 10px; font-size: 0.9em;">–°–±—Ä–æ—Å–∏—Ç—å</a>
    </form>

    {% if incidents %}
    <table>
        <thead>
        <tr>
            <th>–î–∞—Ç–∞ –∏ –º–µ—Å—Ç–æ</th>
            <th>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–¢—è–∂–µ—Å—Ç—å</th>
            <th>–ü–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏–π (–°–æ—Ç—Ä—É–¥–Ω–∏–∫)</th>
            <th style="width: 80px;">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        {% for incident in incidents %}
        <tr
            {% if incident.severity == 'critical' %}style="background-color: #fcebeb;"
            {% elif incident.severity == 'major' %}style="background-color: #fffaf0;"
            {% endif %}>
            <td>
                <strong>{{ incident.incident_date|date:"d.m.Y H:i" }}</strong>
                <div style="font-size: 0.85em; color: #666; margin-top: 3px;">
                    {{ incident.location|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}
                </div>
            </td>
            <td>
                <a href="{% url 'incidents:incident_detail' incident.pk %}" style="color: var(--primary-color);">
                    {{ incident.title|truncatechars:70 }}
                </a>
            </td>
            <td>
                {% if incident.severity == 'critical' %}
                    <span class="badge" style="background-color: #c0392b; color: white;">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π</span>
                {% elif incident.severity == 'major' %}
                    <span class="badge badge-warning">–°–µ—Ä—å–µ–∑–Ω—ã–π</span>
                {% elif incident.severity == 'minor' %}
                    <span class="badge badge-info">–ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π</span>
                {% else %}
                    <span class="badge badge-success">–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫</span>
                {% endif %}
            </td>
            <td>
                {% if incident.employee %}
                    <a href="{% url 'employees:employee_detail' incident.employee.pk %}">
                        {{ incident.employee.last_name }} {{ incident.employee.first_name }}
                    </a>
                {% else %}
                    <span style="color: #999;">–ì–æ—Å—Ç—å / –î—Ä—É–≥–æ–µ</span>
                {% endif %}
            </td>
            <td>
                <a href="{% url 'incidents:incident_update' incident.pk %}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 30px; color: #777;">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.</p>
    {% endif %}
</section>
{% endblock %}