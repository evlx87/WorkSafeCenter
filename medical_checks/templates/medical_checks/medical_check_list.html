{% extends 'base.html' %}
{% block title %}WorkSafeCenter - –†–µ–µ—Å—Ç—Ä –º–µ–¥–æ—Å–º–æ—Ç—Ä–æ–≤{% endblock %}

{% block content %}
<section>
    <div class="section-header">
        <h2>ü©∫ –ñ—É—Ä–Ω–∞–ª –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –º–µ–¥–æ—Å–º–æ—Ç—Ä–æ–≤</h2>
        <a href="{% url 'medical_checks:medical_check_create' %}" class="button"> + –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–æ—Å–º–æ—Ç—Ä</a>
    </div>

    <form method="get" action="{% url 'medical_checks:medical_check_list' %}" class="filter-toolbar">
        <input
            type="text"
            name="search_query"
            placeholder="üîç –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞..."
            value="{{ search_query }}"
        >
        <select name="status">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="overdue" {% if selected_status == "overdue" %}selected{% endif %}>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</option>
            <option value="upcoming" {% if selected_status == "upcoming" %}selected{% endif %}>–°–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞—é—Ç</option>
            <option value="valid" {% if selected_status == "valid" %}selected{% endif %}>–î–µ–π—Å—Ç–≤—É—é—â–∏–µ</option>
        </select>

        <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <a href="{% url 'medical_checks:medical_check_list' %}" style="color: #666; margin-left: 10px; font-size: 0.9em;">–°–±—Ä–æ—Å–∏—Ç—å</a>
    </form>

    {% if medical_checks %}
    <table>
        <thead>
        <tr>
            <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫ / –î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
            <th>–î–∞—Ç–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</th>
            <th>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ</th>
            <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
            <th style="width: 100px;">–°—Ç–∞—Ç—É—Å</th>
            <th style="width: 80px;">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        {% for check in medical_checks %}
        <tr {% if check.is_overdue %}style="background-color: #fef5f5;"{% endif %}>
            <td>
                <a href="{% url 'employees:employee_detail' check.employee.pk %}" style="font-weight: bold; color: var(--primary-color);">
                    {{ check.employee.last_name }} {{ check.employee.first_name }}
                </a>
                <div style="font-size: 0.85em; color: #666; margin-top: 3px;">
                    {{ check.employee.position|default:"–ù–µ—Ç –¥–æ–ª–∂–Ω–æ—Å—Ç–∏" }}
                </div>
            </td>
            <td>{{ check.check_date|date:"d.m.Y" }}</td>
            <td>
                {% if check.next_check_date %}
                    <strong>{{ check.next_check_date|date:"d.m.Y" }}</strong>
                {% else %}
                    –ë–µ—Å—Å—Ä–æ—á–Ω–æ
                {% endif %}
            </td>
            <td>
                {% if check.is_fit %}
                    <span style="color: var(--success-color); font-weight: 600;">–ì–æ–¥–µ–Ω</span>
                {% else %}
                    <span style="color: var(--danger-color); font-weight: 600;">–ù–µ –≥–æ–¥–µ–Ω</span>
                {% endif %}
            </td>
            <td>
                {% if check.is_overdue %}
                    <span class="badge badge-danger">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω</span>
                {% elif check.days_to_expire < 60 %}
                    <span class="badge badge-warning">–ú–µ–Ω–µ–µ 2 –º–µ—Å.</span>
                {% else %}
                    <span class="badge badge-success">–î–µ–π—Å—Ç–≤—É–µ—Ç</span>
                {% endif %}
            </td>
            <td>
                <a href="{% url 'medical_checks:medical_check_update' check.pk %}" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 30px; color: #777;">–ú–µ–¥–æ—Å–º–æ—Ç—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
    {% endif %}
</section>
{% endblock %}