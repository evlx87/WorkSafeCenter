{% extends 'base.html' %}
{% block title %}
WorkSafeCenter - Список сотрудников
{% endblock %}
{% block content %}
<section>
  <h2>Список сотрудников</h2>
  <a href="{% url 'employees:employee_create' %}" class="button">Добавить сотрудника</a>
  <br><br>

  <form method="get" action="{% url 'employees:employee_list' %}" style="margin-bottom: 20px;">
    <div style="display: flex; gap: 15px; align-items: center;">
      <input
              type="text"
              name="search_query"
              placeholder="Поиск по фамилии..."
              value="{{ search_query }}"
      >
      <select name="department">
        <option value="">Все отделы</option>
        {% for dept in departments %}
        <option
                value="{{ dept.pk }}"
                {% if dept.pk|stringformat:"s" == selected_department %}selected{% endif %}
        >
        {{ dept.name }}
        </option>
        {% endfor %}
      </select>
      <button type="submit">Найти</button>
      <a href="{% url 'employees:employee_list' %}">Сбросить</a>
    </div>
  </form>
  {% if employees %}
  <table border="1" cellpadding="5" cellspacing="0" width="100%">
    <thead>
    <tr>
      <th>ФИО</th>
      <th>Должность</th>
      <th>Отдел</th>
      <th>Статус</th>
      <th>Действия</th>
    </tr>
    </thead>
    <tbody>
    {% for employee in employees %}
    <tr>
      <td>
        <a href="{% url 'employees:employee_detail' employee.pk %}">{{ employee.last_name }} {{ employee.first_name }} {{ employee.middle_name }}</a>
        {% if employee.is_safety_committee_member %}
        <span style="color: #007bff; font-weight: bold; font-size: 0.9em;"> (Комиссия)</span>
        {% endif %}
      </td>
      <td>{{ employee.position }}</td>
      <td>{{ employee.department|default:"-" }}</td>

      <td>
        {% if employee.termination_date %}
        <span style="color: red;">Уволен {{ employee.termination_date|date:"d.m.Y" }}</span>
        {% elif employee.on_parental_leave %}
        <span style="color: blue;">В декрете</span>
        {% else %}
        <span style="color: green;">Активен</span>
        {% endif %}
      </td>
      <td>
        <a href="{% url 'employees:employee_update' employee.pk %}">Редактировать</a> |
        <a href="{% url 'employees:employee_delete' employee.pk %}">Удалить</a>
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>Сотрудники не найдены.</p>
  {% endif %}
</section>
{% endblock %}