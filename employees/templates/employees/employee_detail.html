{% extends 'base.html' %}
{% block title %}–ö–∞—Ä—Ç–æ—á–∫–∞: {{ employee.last_name }} {{ employee.first_name }}{% endblock %}

{% block content %}
<section style="background: transparent; box-shadow: none; padding: 0;">

  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2>{{ employee.last_name }} {{ employee.first_name }} {{ employee.middle_name }}</h2>
      <div>
          <a href="{% url 'employees:employee_update' employee.pk %}" class="button" style="background-color: var(--warning-color);">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
          <a href="{% url 'employees:employee_list' %}" class="button" style="background-color: #95a5a6;">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
      </div>
  </div>

  <div class="profile-header">
      <div class="profile-card {% if employee.termination_date %}terminated{% endif %}">
          <h3 class="profile-title">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å</h3>

          {% if employee.termination_date %}
          <div style="background: #fee; padding: 10px; border-radius: 4px; margin-bottom: 15px; color: #c0392b;">
            <strong>‚ö†Ô∏è –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–≤–æ–ª–µ–Ω:</strong> {{ employee.termination_date|date:"d.m.Y" }} (–ü—Ä–∏–∫–∞–∑ ‚Ññ {{ employee.termination_order_number }})
          </div>
          {% endif %}

          <div class="info-grid">
              <div class="info-item">
                  <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                  <span>{{ employee.position }}</span>
              </div>
              <div class="info-item">
                  <label>–û—Ç–¥–µ–ª</label>
                  <span>{{ employee.department }}</span>
              </div>
              <div class="info-item">
                  <label>–î–∞—Ç–∞ –Ω–∞–π–º–∞</label>
                  <span>{{ employee.hire_date|date:"d.m.Y" }}</span>
              </div>
              <div class="info-item">
                  <label>Email</label>
                  <span>{{ employee.email|default:"-" }}</span>
              </div>
              <div class="info-item">
                  <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                  <span>{{ employee.phone|default:"-" }}</span>
              </div>
              <div class="info-item">
                  <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                  <span>{{ employee.birth_date|date:"d.m.Y" }}</span>
              </div>
          </div>
      </div>

      <div class="profile-card">
          <h3 class="profile-title">–°—Ç–∞—Ç—É—Å</h3>
          <div style="display: flex; flex-direction: column; gap: 10px;">
              <div>
                  <label style="color:#777; font-size:0.85em;">–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</label><br>
                  {% if employee.termination_date %}
                    <span class="badge badge-danger">–£–≤–æ–ª–µ–Ω</span>
                  {% elif employee.on_parental_leave %}
                    <span class="badge badge-info">–í –¥–µ–∫—Ä–µ—Ç–µ</span>
                  {% else %}
                    <span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                  {% endif %}
              </div>

              {% if employee.is_safety_committee_member %}
              <div>
                  <span class="badge badge-warning">–ß–ª–µ–Ω –∫–æ–º–∏—Å—Å–∏–∏ –ø–æ –û–¢</span>
              </div>
              {% endif %}

              {% if employee.is_executive %}
              <div>
                  <span class="badge" style="background: #2c3e50; color: white;">–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ</span>
              </div>
              {% endif %}
          </div>
      </div>
  </div>
</section>

<section>
    <div class="section-header">
        <h3>–£—Å–ª–æ–≤–∏—è —Ç—Ä—É–¥–∞ –∏ —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ</h3>
        {% if not employee.workplace %}
            <span style="color: var(--danger-color); font-weight: bold;">‚ö†Ô∏è –†–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ</span>
        {% endif %}
    </div>

    {% if employee.workplace %}
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="profile-card" style="margin-bottom: 0;">
            <h4 style="border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;">–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ (–°–û–£–¢)</h4>
            <p><strong>–†–ú ‚Ññ:</strong> {{ employee.workplace.number }}</p>
            {% if employee.workplace.sout %}
                <p><strong>–ö–ª–∞—Å—Å —É—Å–ª–æ–≤–∏–π:</strong> {{ employee.workplace.sout.get_class_conditions_display }}</p>
                <p><strong>–î–∞—Ç–∞ –æ—Ü–µ–Ω–∫–∏:</strong> {{ employee.workplace.sout.assessment_date|date:"d.m.Y" }}</p>
                <p><strong>–°–ª–µ–¥—É—é—â–∞—è –æ—Ü–µ–Ω–∫–∞:</strong>
                    <span style="{% if employee.workplace.sout.next_assessment_date < today %}color: var(--danger-color); font-weight: bold;{% endif %}">
                        {{ employee.workplace.sout.next_assessment_date|date:"d.m.Y" }}
                    </span>
                </p>
            {% else %}
                <p style="color: #7f8c8d; font-style: italic;">–î–∞–Ω–Ω—ã–µ –°–û–£–¢ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
            {% endif %}
        </div>

        <div class="profile-card" style="margin-bottom: 0;">
            <h4 style="border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏</h4>
            {% if employee.workplace.risks.all %}
                <table style="font-size: 0.9em; margin-top: 10px;">
                    <thead>
                        <tr>
                            <th>–ò—Å—Ç–æ—á–Ω–∏–∫ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏</th>
                            <th>–£—Ä–æ–≤–µ–Ω—å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for risk in employee.workplace.risks.all %}
                        <tr>
                            <td>{{ risk.hazard_source }}</td>
                            <td>
                                <span style="
                                    padding: 2px 6px;
                                    border-radius: 4px;
                                    color: white;
                                    background-color: {% if risk.risk_level == 'high' or risk.risk_level == 'critical' %}var(--danger-color){% elif risk.risk_level == 'medium' %}var(--warning-color){% else %}#27ae60{% endif %};
                                ">
                                    {{ risk.get_risk_level_display }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="color: #7f8c8d; font-style: italic;">–†–∏—Å–∫–∏ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã</p>
            {% endif %}
        </div>
    </div>
    {% else %}
        <p style="text-align: center; padding: 20px; background: #f9f9f9; border-radius: 8px;">
            –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π —Ç—Ä—É–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–∫—Ä–µ–ø–∏—Ç—å –∑–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º <strong>–†–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ</strong> –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
        </p>
    {% endif %}
</section>

{% if has_compliance_issues %}
<section style="border-left: 5px solid var(--danger-color); background-color: #fff5f5;">
    <h3>‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–∏–º–∞–Ω–∏–µ (–ù–µ–¥–æ—Å—Ç–∞—é—â–µ–µ –æ–±—É—á–µ–Ω–∏–µ)</h3>

    {% if compliance.missing_programs %}
    <p><strong>–ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ:</strong></p>
    <ul>
        {% for prog in compliance.missing_programs %}
            <li>{{ prog.name }} <a href="{% url 'trainings:training_create' employee.pk %}?program={{ prog.id }}">[–î–æ–±–∞–≤–∏—Ç—å]</a></li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if compliance.expired_programs %}
    <p><strong>–ò—Å—Ç–µ–∫ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –æ–±—É—á–µ–Ω–∏—è:</strong></p>
    <ul>
        {% for prog in compliance.expired_programs %}
            <li style="color: var(--danger-color);">{{ prog.name }} (–°—Ä–æ–∫ –∏—Å—Ç–µ–∫) <a href="{% url 'trainings:training_create' employee.pk %}?program={{ prog.id }}">[–û–±–Ω–æ–≤–∏—Ç—å]</a></li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if compliance.missing_instructions or compliance.expired_instructions %}
    <p><strong>–ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∞–º–∏:</strong></p>
    <ul>
        {% for instr in compliance.missing_instructions %}
            <li>–ù–µ –ø—Ä–æ–≤–µ–¥–µ–Ω: {{ instr.name }}</li>
        {% endfor %}
        {% for instr in compliance.expired_instructions %}
            <li style="color: var(--danger-color);">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω: {{ instr.name }}</li>
        {% endfor %}
    </ul>
    <a href="{% url 'trainings:safety_training_create' employee.pk %}" class="button" style="font-size: 0.8em;">–ü—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂</a>
    {% endif %}
</section>
{% endif %}

<section>
  <div class="section-header">
      <h3>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ</h3>
      <a href="{% url 'trainings:training_create' employee.pk %}" class="button">–î–æ–±–∞–≤–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</a>
  </div>

  {% if employee.trainings.all %}
  <table>
    <thead>
    <tr>
      <th>–ü—Ä–æ–≥—Ä–∞–º–º–∞</th>
      <th>–î–∞—Ç–∞</th>
      <th>–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å</th>
      <th>–î–æ–∫—É–º–µ–Ω—Ç</th>
      <th style="width: 150px;">–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
    </thead>
    <tbody>
    {% for training in employee.trainings.all %}
    <tr>
      <td>
          <strong>{{ training.program.name }}</strong><br>
          <small style="color:#666;">{{ training.program.hours }} —á–∞—Å–æ–≤</small>
      </td>
      <td>{{ training.training_date|date:"d.m.Y" }}</td>
      <td>
          {% if training.program.frequency_months > 0 %}
            –†–∞–∑ –≤ {{ training.program.frequency_months }} –º–µ—Å.
          {% else %}
            –ë–µ—Å—Å—Ä–æ—á–Ω–æ
          {% endif %}
      </td>
      <td>
        {% if training.document_scan %}
        <a href="{{ training.document_scan.url }}" target="_blank" style="color: var(--accent-color);">üìÑ –°–∫–∞—á–∞—Ç—å PDF</a>
        {% else %}
        <span style="color: #ccc;">–ù–µ—Ç —Ñ–∞–π–ª–∞</span>
        {% endif %}
      </td>
      <td>
        <a href="{% url 'trainings:training_update' employee.pk training.pk %}" style="margin-right: 10px;">‚úèÔ∏è</a>
        <a href="{% url 'trainings:training_delete' employee.pk training.pk %}" style="color: var(--danger-color);">üóëÔ∏è</a>
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p style="color: #666; font-style: italic;">–ó–∞–ø–∏—Å–µ–π –æ–± –æ–±—É—á–µ–Ω–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
  {% endif %}
</section>

<section>
  <div class="section-header">
      <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∏ –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞</h3>
      <a href="{% url 'trainings:safety_training_create' employee.pk %}" class="button">–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂</a>
  </div>

  {% if employee.instructions.all %}  <table>
    <thead>
    <tr>
      <th>–¢–∏–ø / –ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
      <th>–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è</th>
      <th>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ</th>
      <th>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</th>
      <th style="width: 150px;">–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
    </thead>
    <tbody>
    {% for st in employee.instructions.all %} <tr>
      <td>
          <strong>{{ st.instruction_type.name }}</strong><br>
          <small>{{ st.instruction_type.get_category_display }}</small>
      </td>
      <td>{{ st.training_date|date:"d.m.Y" }}</td>
      <td>
          {% if st.next_training_date %}
             {{ st.next_training_date|date:"d.m.Y" }}
          {% else %}
             -
          {% endif %}
      </td>
      <td>{{ st.instructor }}</td>
      <td>
        <a href="{% url 'trainings:safety_training_update' employee.pk st.pk %}" style="margin-right: 10px;">‚úèÔ∏è</a>
        <a href="{% url 'trainings:safety_training_delete' employee.pk st.pk %}" style="color: var(--danger-color);">üóëÔ∏è</a>
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p style="color: #666; font-style: italic;">–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∏ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∏—Å—å.</p>
  {% endif %}
</section>
{% endblock %}